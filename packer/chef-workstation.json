{
  "builders": [{
    "type": "amazon-ebs",
    "access_key": "{{user `aws_access_key`}}",
    "secret_key": "{{user `aws_secret_key`}}",
    "region": "us-west-2",
    "source_ami": "ami-63b25203",
    "instance_type": "t2.micro",
    "ssh_username": "ec2-user",
    "ami_name": "packer-chef-workstation {{timestamp}}"
  }],
  "provisioners": [{
    "type": "shell",
    "inline": [
      "sleep 30",

      "sudo yum update -y",
      "sudo yum install zlib-devel git gcc ruby rubygems ruby-devel -y",
      "sudo gem update --system",

      "sudo gem install knife-solo --no-doc --no-ri",
      "sudo gem install knife-solo_data_bag --no-doc --no-ri",
      "sudo gem install knife-ec2 --no-doc --no-ri",
      "sudo su - -c 'mkdir -p /etc/chef/ohai/hints && touch /etc/chef/ohai/hints/ec2.json'",

      "knife solo init chef-repo",
      "cd chef-repo",

      "knife cookbook site download hostsfile",
      "tar xvzf hostsfile*.tar.gz --directory cookbooks; rm hostsfile*.tar.gz; mkdir cookbooks/hostsfile/recipes",
      "knife cookbook site download ntp",
      "tar xvzf ntp*.tar.gz --directory cookbooks; rm ntp*.tar.gz",
      "knife cookbook site download windows", 
      "tar xvzf windows*.tar.gz --directory cookbooks; rm windows*.tar.gz",

      "knife cookbook site download chef_handler",
      "tar xvzf chef_handler*.tar.gz --directory cookbooks; rm chef_handler*.tar.gz"
    ]
  }]
}
